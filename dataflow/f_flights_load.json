{
	"name": "f_flights_load",
	"properties": {
		"folder": {
			"name": "Flights"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "sql_flights",
						"type": "DatasetReference"
					},
					"name": "StagingFlights"
				},
				{
					"dataset": {
						"referenceName": "sql_d_aprt",
						"type": "DatasetReference"
					},
					"name": "ARPT"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "FilterFlightType"
				},
				{
					"name": "LookupIATA"
				},
				{
					"name": "FilterActvInd"
				},
				{
					"name": "RemoveColumns1"
				},
				{
					"name": "LookupICAO"
				},
				{
					"name": "AddBaseAirportID"
				},
				{
					"name": "RemoveIATAICAO"
				},
				{
					"name": "LookupIATA2"
				},
				{
					"name": "RemoveColumns2"
				},
				{
					"name": "LookupICAO2"
				},
				{
					"name": "AddSchdDptrID"
				},
				{
					"name": "RemoveIATAICAO2"
				},
				{
					"name": "LookupIATA3"
				},
				{
					"name": "RemoveColumns3"
				},
				{
					"name": "LookupICAO3"
				},
				{
					"name": "AddSchdArrID"
				},
				{
					"name": "RemoveIATAICAO3"
				},
				{
					"name": "LookupIATA4"
				},
				{
					"name": "RemoveColumns4"
				},
				{
					"name": "LookupICAO4"
				},
				{
					"name": "AddActArrID"
				},
				{
					"name": "RemoveIATAICAO4"
				},
				{
					"name": "AddNewColumns"
				}
			],
			"script": "source(output(\n\t\tACTL_ARRVL_AIR_PORT as string,\n\t\tACTL_DPTR_AIR_PORT as string,\n\t\tACTL_OOOI_IN as timestamp,\n\t\tACTL_OOOI_OFF as timestamp,\n\t\tACTL_OOOI_ON as timestamp,\n\t\tACTL_OOOI_OUT as timestamp,\n\t\tAIR_CRAFT_RGSTRN_NUM as string,\n\t\tAIR_CRAFT_TYPE as string,\n\t\tBASE_AIR_PORT as string,\n\t\tCRGO_WGT as integer,\n\t\tESTD_ARRVL as timestamp,\n\t\tESTD_DPTR as timestamp,\n\t\tFLT_DT as date,\n\t\tFLT_ID as long,\n\t\tFLT_NUM as string,\n\t\tFLT_TYPE as string,\n\t\tFUEL_IN as double,\n\t\tFUEL_OUT as double,\n\t\tFUEL_UPLIFT as integer,\n\t\tIS_CNCLD as boolean,\n\t\tIS_VERFD as boolean,\n\t\tMAINT_LOG_PG as string,\n\t\tNOTES as string,\n\t\tSCHDD_ARRVL as timestamp,\n\t\tSCHDD_ARRVL_AIR_PORT as string,\n\t\tSCHDD_DPTR as timestamp,\n\t\tSCHDD_DPTR_AIR_PORT as string,\n\t\tUPDTD_AT as timestamp,\n\t\tDLAY_TYP as string,\n\t\tDURTN_MNT as integer,\n\t\tDLAY_CD as string,\n\t\tDLAY_CD_NAME as string,\n\t\tADF_TIME_STMP as timestamp,\n\t\tADF_RUN_ID as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> StagingFlights\nsource(output(\n\t\tARPT_ID as integer,\n\t\tARPT_IATA_CD as string,\n\t\tARPT_ICAO_CD as string,\n\t\tARPT_NAME as string,\n\t\tARPT_CNTRY as string,\n\t\tARPT_CITY as string,\n\t\tARPT_LAT as decimal(8,6),\n\t\tARPT_LONG as decimal(9,6),\n\t\tARPT_ALTD as decimal(6,2),\n\t\tARPT_UTC_OFSET as decimal(2,2),\n\t\tARPT_DST_CD as string,\n\t\tARPT_TZONE as string,\n\t\tEFF_STRT_DT as timestamp,\n\t\tEFF_END_DT as timestamp,\n\t\tACTV_IND as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> ARPT\nStagingFlights filter(FLT_TYPE <=>'flight') ~> FilterFlightType\nFilterFlightType, FilterActvInd lookup(BASE_AIR_PORT == ARPT_IATA_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupIATA\nARPT filter(ACTV_IND == 'Y') ~> FilterActvInd\nLookupIATA select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID,\n\t\tIATA_ARPT_ID = ARPT_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumns1\nRemoveColumns1, FilterActvInd lookup(BASE_AIR_PORT == ARPT_ICAO_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupICAO\nLookupICAO derive(BASE_ARPT_ID = iif(isNull(IATA_ARPT_ID), ARPT_ID, IATA_ARPT_ID)) ~> AddBaseAirportID\nAddBaseAirportID select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveIATAICAO\nRemoveIATAICAO, FilterActvInd lookup(SCHDD_DPTR_AIR_PORT == ARPT_IATA_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupIATA2\nLookupIATA2 select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID,\n\t\tIATA_ARPT_ID = ARPT_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumns2\nRemoveColumns2, FilterActvInd lookup(ACTL_DPTR_AIR_PORT == ARPT_ICAO_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupICAO2\nLookupICAO2 derive(SCHDD_DRPT_ARPT_ID = iif(isNull(IATA_ARPT_ID), ARPT_ID, IATA_ARPT_ID)) ~> AddSchdDptrID\nAddSchdDptrID select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tSCHDD_DRPT_ARPT_ID,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveIATAICAO2\nRemoveIATAICAO2, FilterActvInd lookup(ACTL_ARRVL_AIR_PORT == ARPT_IATA_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupIATA3\nLookupIATA3 select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tSCHDD_DRPT_ARPT_ID,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID,\n\t\tIATA_ARPT_ID = ARPT_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumns3\nRemoveColumns3, FilterActvInd lookup(ACTL_ARRVL_AIR_PORT == ARPT_ICAO_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupICAO3\nLookupICAO3 derive(SCHDD_ARRVL_ARPT_ID = iif(isNull(IATA_ARPT_ID), ARPT_ID, IATA_ARPT_ID)) ~> AddSchdArrID\nAddSchdArrID select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_ARRVL_ARPT_ID,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tSCHDD_DRPT_ARPT_ID,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveIATAICAO3\nRemoveIATAICAO3, FilterActvInd lookup(ACTL_ARRVL_AIR_PORT == ARPT_IATA_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupIATA4\nLookupIATA4 select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_ARRVL_ARPT_ID,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tSCHDD_DRPT_ARPT_ID,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID,\n\t\tIATA_ARPT_ID = ARPT_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumns4\nRemoveColumns4, FilterActvInd lookup(ACTL_ARRVL_AIR_PORT == ARPT@ARPT_ICAO_CD,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupICAO4\nLookupICAO4 derive(ACTL_ARRVL_ARPT_ID = iif(isNull(IATA_ARPT_ID), ARPT_ID, IATA_ARPT_ID)) ~> AddActArrID\nAddActArrID select(mapColumn(\n\t\tACTL_ARRVL_AIR_PORT,\n\t\tACTL_ARRVL_ARPT_ID,\n\t\tACTL_DPTR_AIR_PORT,\n\t\tACTL_OOOI_IN,\n\t\tACTL_OOOI_OFF,\n\t\tACTL_OOOI_ON,\n\t\tACTL_OOOI_OUT,\n\t\tAIR_CRAFT_RGSTRN_NUM,\n\t\tAIR_CRAFT_TYPE,\n\t\tBASE_AIR_PORT,\n\t\tBASE_ARPT_ID,\n\t\tCRGO_WGT,\n\t\tESTD_ARRVL,\n\t\tESTD_DPTR,\n\t\tFLT_DT,\n\t\tFLT_ID,\n\t\tFLT_NUM,\n\t\tFLT_TYPE,\n\t\tFUEL_IN,\n\t\tFUEL_OUT,\n\t\tFUEL_UPLIFT,\n\t\tIS_CNCLD,\n\t\tIS_VERFD,\n\t\tMAINT_LOG_PG,\n\t\tNOTES,\n\t\tSCHDD_ARRVL,\n\t\tSCHDD_ARRVL_AIR_PORT,\n\t\tSCHDD_ARRVL_ARPT_ID,\n\t\tSCHDD_DPTR,\n\t\tSCHDD_DPTR_AIR_PORT,\n\t\tSCHDD_DRPT_ARPT_ID,\n\t\tUPDTD_AT,\n\t\tDLAY_TYP,\n\t\tDURTN_MNT,\n\t\tDLAY_CD,\n\t\tDLAY_CD_NAME,\n\t\tADF_TIME_STMP,\n\t\tADF_RUN_ID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveIATAICAO4\nRemoveIATAICAO4 derive(DEP_VAR = ACTL_OOOI_OUT - SCHDD_DPTR,\n\t\tARRVL_VAR = ACTL_OOOI_IN - SCHDD_ARRVL,\n\t\tSCHDD_BLK_DUR = SCHDD_DPTR - SCHDD_ARRVL,\n\t\tACTL_BLK_DUR = ACTL_OOOI_OUT - ACTL_OOOI_IN,\n\t\tACTL_FLGHT_DUR = ACTL_OOOI_OUT - ACTL_OOOI_IN,\n\t\tDPRT_DELAY_DUR_D0_IND = '',\n\t\tDPRT_DELAY_DUR_D15_IND = '',\n\t\tARRVL_DELAY_DUR_A0_IND = '',\n\t\tARRVL_DELAY_DUR_A14_IND = '',\n\t\tBLK_DUR_B0_IND = '',\n\t\tSCHDD_FLT_DUR = '') ~> AddNewColumns"
		}
	}
}